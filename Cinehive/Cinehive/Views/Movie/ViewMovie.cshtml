@model HiveData.Models.Movie

@{
    ViewBag.Title = "ViewMovie";
}

<div class="container">
    <br/>
    <div class="panel">
        @if (Model == null || Model.MovieApi_ID == 0)
        {
            <h5 class="text-center">Could not find movie</h5>
        }
        else
        {
            <h2>@Model.Title</h2>
            <div class="media">
                <div class="media-left">
                    @if (Model.PosterPath == null)
                    {
                        <img class="img" src="~/Content/Img/poster-placeholder.jpg" width="320" />
                    }
                    else
                    {
                        <img class="img" src="http://image.tmdb.org/t/p/w342@(Model.PosterPath)" width="320" />
                    }
                </div>
                <div class="media-right">
                    @if (Model.VideoKey != null)
                    {
                        <iframe width="560" height="315" src="https://www.youtube.com/embed/@(Model.VideoKey)" title="YouTube video player"
                                frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media;
                    gyroscope; picture-in-picture" allowfullscreen></iframe>
                    }
                </div>
                <div class="media"></div>
            </div>
            <br />
            if(User.Identity.IsAuthenticated)
            {
    <ul class="list-unstyled">
        @*<li>
            <a href="@Url.Action("RateMovie","Movie",
                    new { movieApiID = Model.MovieApi_ID, stars = 1})" onclick="StarFilled()">
                <i id="star1" class="glyphicon glyphicon-star-empty"></i>1 star
            </a>
        </li>*@
        <li>
            <button type="button" onclick="FillStar(1)">
                <i id="star1" class="glyphicon glyphicon-star-empty"></i>1 star
            </button>
        </li>
        <li>
            <button type="button" onclick="FillStar(2)">
                <i id="star2" class="glyphicon glyphicon-star-empty"></i>2 star
            </button>
        </li>
        <li>
            <button type="button" onclick="FillStar(3)">
                <i id="star3" class="glyphicon glyphicon-star-empty"></i>3 star
            </button>
        </li>
        <li>
            <button type="button" onclick="FillStar(4)">
                <i id="star4" class="glyphicon glyphicon-star-empty"></i>4 star
            </button>
        </li>
        <li>
            <button type="button" onclick="FillStar(5)">
                <i id="star5" class="glyphicon glyphicon-star-empty"></i>5 star
            </button>
        </li>
    </ul>
            }
            <dl class="dl-horizontal">
                <dt>
                    Overview:
                </dt>

                <dd>
                    @Html.DisplayFor(model => model.Overview)
                </dd>

                <dt>
                    Release Date:
                </dt>

                <dd>
                    @Html.DisplayFor(model => model.ReleaseDate)
                </dd>
            </dl>
        }
    </div>
</div>

<script>
    function FillStar(star) {
        console.log("button clicked")
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                document.getElementById("star" + star).className = "glyphicon glyphicon-star";
            }
        };
        xhttp.open("GET", "https://localhost:44383/Movie/RateMovie?movieApiID=" + @Model.MovieApi_ID.ToString() + "&stars="+star, true);
        console.log(xhttp);
        xhttp.send();        
    }
</script>
