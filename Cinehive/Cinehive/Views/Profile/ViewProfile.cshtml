@model HiveData.Models.UserProfile
@using Microsoft.AspNet.Identity;

@{
    ViewBag.Title = @Model.Firstname + "'s Profile";
}

<div class="container">
    <div class="row profile">

        @Html.Partial("ViewProfilePartial")

        <div class="col-md-9">
            @if (Model.Privacy == 1 || Model.Privacy == 2 && ViewBag.IsFriend)
            {
                foreach (var item in Model.Posts.OrderByDescending(x => x.DatePosted))
                {
                    <div class="profile-content-pane">
                        <div class="media">
                            <a class="pull-left" href="">
                                @if (Model.ImagePath == null)
                                {
                                    <img src="~/Content/Img/profile-image-placeholder.png" width="64" height="64" class="circular-image" />
                                }
                                else
                                {
                                    <img src="~/@Model.ImagePath" width="64" height="64" class="circular-image" />
                                }
                            </a>
                            <div class="media-body">
                                <h4 class="media-heading">@Model.Firstname @Model.Lastname</h4>
                                <p>
                                    @*Display posts containg film links with Html.Raw*@
                                    @if ((bool)item.hasFilmLink)
                                    {@Html.Raw(@item.PostContent) }
                                else
                                { @item.PostContent}
                                </p>
                                <ul class="list-inline list-unstyled">
                                    <li> @item.DatePosted </li>
                                    <li>|</li>
                                    @if (item.Awards < 2)
                                    {
                                        <li> @item.Awards Award</li>

                                    }
                                    else
                                    {
                                        <li> @item.Awards Awards</li>
                                    }
                                </ul>
                                <ul class="list-inline list-unstyled">
                                    <li>@Html.ActionLink("Award", "")</li>
                                    <li>|</li>
                                    <li>@Html.ActionLink("Comment", "")
                                    <li>|</li>
                                    <li>@Html.ActionLink("Share", "")</li>
                                    <li>|</li>
                                    <li><input type="button" class="comment-button" id="post-@item.PostId" name="Comment" value=" Comments(@item.PostComments.Count)" /></li>

                                </ul>
                            </div>

                        </div>

                    </div>
                    <div id="Comments-@item.PostId">

                    </div>
                    @Scripts.Render("~/bundles/jquery")
                    <script>
                        var rendered = false;
                        $("#post-@item.PostId").click(function () {

                            if (!rendered) {

                                $.ajax({
                                    url: '@Url.Action("ProfilePostCommentsPartial", "Post")',
                                    type: "GET",
                                    data: {i_d: @item.PostId},
                                    contentType: "application/json; charset=utf-8",
                                    success: function (result) {
                                    //alert("success");
                                    $("#Comments-@item.PostId").html(result);
                                    rendered = true;
                                    },
                                    error: function (xhr) {
                                    alert("error");
                                    }

                                    });
                            } else {
                                $('#Comments-@item.PostId').html("");
                                rendered = false;
                            }

                        });
                    </script>

                }
            }
            else
            {
                <p> Sorry, This user doesnt want to share their posts</p>
            }

        </div>
        </div>
    </div>